#############################################################################
# CI infrastructure settings
#############################################################################
ci:
  images:
    # Docker image with administration tools
    admin:
      image: ghcr.io/mentalsmash/ci-admin:latest
    # Base Docker image for tester images used by PR tests.
    # The image will be generated for every base image used by the release images.
    tester:
      repo: ghcr.io/mentalsmash/uno-ci-tester
    # Local Docker image generated by all CI tests
    local_tester:
      image: mentalsmash/uno-test-runner:latest
  # Runner labels used by each architecture. Represented as JSON string
  runners:
    linux/amd64: ubuntu-latest
    linux/arm64: [self-hosted, linux, arm64, rpi5]
  test:
    # Directory where test artifacts will be generated by default
    results_dir: test-results

#############################################################################
# Debian packaging settings
#############################################################################
debian:
  artifacts:
    prefix: ref-project-debdocker-deb-
    dist_dir: debian-dist
  builder:
    architectures:
    - amd64
    - arm64
    base_images:
    - ubuntu:22.04
    repo: ghcr.io/mentalsmash/debian-builder

#############################################################################
# Pull Request settings
#############################################################################
pull_request:
  validation:
    basic:
      base_images:
      - ubuntu:22.04
      build_platforms:
      - linux/amd64
    full:
      base_images:
      - ubuntu:22.04
      build_platforms:
      - linux/arm64
    deb:
      base_images:
      - ubuntu:22.04
      build_architectures:
      - amd64

#############################################################################
# Release settings
#############################################################################
release:
  # Image repositories for the released images.
  # Published to both GitHub and DockerHub
  final_repos:
  - ghcr.io/mentalsmash/uno
  - mentalsmash/uno
  # Push pre-release image to GitHub for testing
  prerelease_repo: ghcr.io/mentalsmash/uno-rc
  prerelease_package: mentalsmash/uno-rc

  tracker:
    repository:
      name: mentalsmash/uno-release
      ref: master
    user:
      name: Automated Release Tracker
      email: mentalsmash-admin@users.noreply.github.com

  profiles:
    nightly:
      badge:
        base_image:
          color: blue
          gist: "1fd45f442b8ab91bef6ef56423368128"
        version:
          color: orange
          gist: "9653c15d4e5b0413fb71397e643ab822"
      # Base image for the generated image
      base_image: ubuntu:22.04
      # Build platforms
      build_platforms:
      - linux/amd64
      - linux/arm64
      # The main tag for the generated image
      tag: nightly
      # Add a custom suffix to all generated tags
      tag_suffix: ''
      # Tags configuration for docker/metadata-action
      tags-config: |
        type=semver,pattern={{version}}
        type=semver,pattern={{major}}.{{minor}}
        type=semver,pattern={{major}}
        type=raw,value=nightly,priority=650
        type=ref,event=branch

    stable:
      badge:
        base_image:
          color: blue
          gist: "6391e3a762e26c822281b1dbf2af5bd1"
        version:
          color: green
          gist: "2fda06b2047d0643d91308462197110a"
      # Base image for the generated image
      base_image: ubuntu:22.04
      # Build platforms
      build_platforms:
      - linux/amd64
      - linux/arm64
      # The main tag for the generated image
      tag: latest
      # Add a custom suffix to all generated tags
      tag_suffix: ''
      # Tags configuration for docker/metadata-action
      tags-config: |
        type=semver,pattern={{version}}
        type=semver,pattern={{major}}.{{minor}}
        type=semver,pattern={{major}}

